!function(){"use strict";angular.module("gulpAngularMqttWs",["ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router","ngMaterial","ngStorage"])}(),function(){"use strict";function e(){function e(e){var n=this;n.relativeDate=e(n.creationDate).fromNow()}var n={restrict:"E",templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:e,controllerAs:"vm",bindToController:!0};return e.$inject=["moment"],n}angular.module("gulpAngularMqttWs").directive("acmeNavbar",e)}(),angular.module("gulpAngularMqttWs").filter("status",function(){return function(e,n){if("ALL"==n)return e;var t={};return angular.forEach(e,function(e,i){e.status==n&&(t[i]=e)}),t}}).filter("name",function(){return function(e,n){var t={};return angular.forEach(e,function(e,i){e.d.myName.toLowerCase().indexOf(n.toLowerCase())>-1&&(t[i]=e)}),t}}).filter("isEmpty",function(){var e;return function(n){for(e in n)if(n.hasOwnProperty(e))return!1;return!0}}),angular.module("gulpAngularMqttWs").provider("mqttwsProvider",function(){this.$get=["$q","$window",function(e,n){return function(n){var t,i,o,a=!1,l=!1,r={},c={},d={on:function(e,n){r[e]=n},addListener:function(e,n){r[e]=n},subscribe:function(n,t){return t=t||{qos:0},function(){var i=e.defer(),a=function(){i.resolve(o)};return t.onSuccess=a,o.subscribe(n,t),console.log("SUB",n,t),i.promise}},create:function(n){var a=e.defer();return n=angular.extend(c,n),t=n.host,i=parseInt(n.port,10),console.log("CRESATE",n),o=new Paho.MQTT.Client(t,i,n.clientId),a.resolve(o),a.promise},connect:function(){return function(){var n=e.defer(),t=function(){var e=r.connected||function(){};console.log("CONNECTED"),e.call(null,arguments),n.resolve(arguments)},i=function(e){console.log(e),n.reject(e)},d={timeout:3,useSSL:a,mqttVersion:3,cleanSession:l,onSuccess:t,onFailure:i};return console.log(c),c.username&&(d.userName=c.username,d.password=c.password),o.connect(d),o.onMessageArrived=function(e){var n=e.destinationName,t=e.payloadString,i=r.message||function(){};i.apply(null,[n,t,e]);var o=r[n.toString()]||function(){};o.apply(null,[t,e])},n.promise}}};return d}}]}),function(){"use strict";function e(e,n,t,i,o,a,l,r){function c(e,n,t,i){e.devices=i,e.deviceUUID=t,e.hide=function(){n.hide()},e.cancel=function(){n.cancel()},e.answer=function(e){n.hide(e)}}var d=this;d.devices={},d.LWT={};var s=function(e){var n=l.debounce(function(){a(e).toggle().then(function(){console.log("toggle "+e+" is done")})},200);return n};e.storage=i.$default({config:{host:"gearbroker.netpie.io",port:8083,username:"BZXrhDBMKutYd68%1443014670",password:"i4jmEZaflGYzXxxi2g5byEM5VA4=",clientId:"eqSZOmyJ2oXN4CJs"}}),e.toggleRight=s("right"),e.config=e.storage.config,e.onlineStatus="ALL",e.filterDevice={},e.filterDevice.name="";var u=function(){var n=function(n,t){var i=JSON.parse(t),o=i.info&&i.info.id,a=i.d&&i.d.id;i.status=d.LWT[a||o]||"ONLINE"||"UNKNOWN",i.online="DEAD"!==i.status,d.devices[a||o]=i,delete d.devices.undefined,e.$apply()};t.on("message",n)};e.showDetail=function(n,t){r.show({controller:c,templateUrl:"app/main/detail.html",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!0,locals:{deviceUUID:t,devices:e.allDevices}}).then(function(n){e.status='You said the information was "'+n+'".'},function(){e.status="You cancelled the dialog."})};e.allDevices=function(){return d.devices},e.connect=function(){u(),d.devices={},e.config={host:"gearbroker.netpie.io",port:8083,username:"2syAvlZPSExXY3M%1443015923",password:"Ymyig6VXVNpcXoUrEc+Jl0mpzks=",clientId:"pX1LPwvk6iETiP2Y"},t.create(e.config).then(t.connect()).then(t.subscribe("/HelloChiangMaiMakerClub/gearname/#")).then(function(){console.log("ALL DONE")})},e.disconnect=function(){},c.$inject=["$scope","$mdDialog","deviceUUID","devices"],e.connect()}var n={};angular.module("gulpAngularMqttWs").factory("myMqtt",["mqttwsProvider",function(e){var t=e(n);return t}]).controller("MainController",e),e.$inject=["$scope","$timeout","myMqtt","$localStorage","$sessionStorage","$mdSidenav","$mdUtil","$mdDialog"]}(),function(){"use strict";function e(e){e.debug("runBlock end")}angular.module("gulpAngularMqttWs").run(e),e.$inject=["$log"]}(),function(){"use strict";function e(e,n){e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}),n.otherwise("/")}angular.module("gulpAngularMqttWs").config(e),e.$inject=["$stateProvider","$urlRouterProvider"]}(),function(){"use strict";angular.module("gulpAngularMqttWs").constant("toastr",toastr).constant("moment",moment)}(),function(){"use strict";function e(e,n,t){e.debugEnabled(!0),n.options.timeOut=3e3,n.options.positionClass="toast-top-right",n.options.preventDuplicates=!0,n.options.progressBar=!0}angular.module("gulpAngularMqttWs").config(e),e.$inject=["$logProvider","toastr","$mdThemingProvider"]}(),angular.module("gulpAngularMqttWs").run(["$templateCache",function(e){e.put("app/main/detail.html",'<md-dialog flex="60"><md-toolbar><div class="md-toolbar-tools"><h2>{{ devices()[deviceUUID].d.myName }}</h2><span flex=""></span></div></md-toolbar><md-dialog-content layout-fill=""><md-list class="a"><md-subheader class="md-no-sticky">DATA</md-subheader><md-list-item class="md-2-line" ng-repeat="(key, value) in devices()[deviceUUID].d"><img ng-src="{{item.face}}?{{$index}}" class="md-avatar" alt="{{item.who}}"><div class="md-list-item-text" layout="column"><h3>{{ key }}</h3><p>{{ value }}</p></div></md-list-item></md-list><md-divider></md-divider><md-list class="b"><md-subheader class="md-no-sticky">INFO</md-subheader><md-list-item class="md-2-line" ng-repeat="(key, value) in devices()[deviceUUID].info"><md-icon md-svg-icon="communication:phone" ng-if="$index === 0"></md-icon><div class="md-list-item-text" ng-class="{\'md-offset\': $index != 0 }"><h3>{{ key }}</h3><p>{{ value }}</p></div></md-list-item></md-list></md-dialog-content></md-dialog>'),e.put("app/main/main.html",'<div layout="column" layout-fill="" class="nat-wrapper"><md-content layout-padding=""><header><acme-navbar creationdate="main.creationDate"></acme-navbar></header><section class="jumbotron"><div layout="row" layout-align="end center"><md-input-container><label>Filter by name</label> <input ng-model="filterDevice.name"></md-input-container><md-input-container><label>Status</label><md-select name="onlineStatus" ng-model="onlineStatus" required=""><md-optgroup label="Status"><md-option value="ALL">All</md-option><md-option value="ONLINE">Online</md-option><md-option value="DEAD">Offline</md-option></md-optgroup></md-select></md-input-container><md-button ng-click="toggleRight()" class="md-primary">Config</md-button></div><div class="techs" layout-align="center"><md-card ng-class="device.status" ng-repeat="(key, device) in main.devices | name:filterDevice.name | status:onlineStatus | orderBy:\'status\'"><div class="thumbnail"><div class="caption"><h3>{{ device.d.myName }} - {{ device.status }}</h3><div ng-show="{{ device.info.id !=\'\' || device.d.id != \'\'}}">{{ device.info.id || device.d.id }}</div><div>{{ device.d.ip }}</div><div>{{ device.d.seconds }} ({{ device.d.subscription }})</div><div>{{ device.info.sensor || device.d.sensor || "?" }}</div><div ng-show="{{device.online}}">{{ device.info.id || device.d.id }}/status</div></div></div><div class="md-actions" layout="row" layout-align="end center"><md-button ng-click="showDetail($event, key)">Detail</md-button></div></md-card></div></section><section><md-sidenav class="md-sidenav-right md-whiteframe-z2" md-component-id="right" layout-align="start center"><md-toolbar class="md-theme-light" layout="row" layout-align="center center">Config</md-toolbar><md-content layout-padding="" class="autoScroll"><md-input-container><label>Host</label> <input ng-model="config.host"></md-input-container><md-input-container><label>Port</label> <input ng-model="config.port"></md-input-container><md-input-container ng-show="data.cb_auth"><label>Username</label> <input ng-model="config.username"></md-input-container><md-input-container ng-show="data.cb_auth"><label>Password</label> <input ng-model="config.password" type="password"></md-input-container><md-input-container ng-show="data.cb_clientId"><label>clientId</label> <input ng-model="config.clientId" type="clientId"></md-input-container><md-checkbox ng-init="data.cb_auth=false" ng-model="data.cb_auth" aria-label="Checkbox 2" class="md-warn md-align-top-left">username & password</md-checkbox><md-checkbox ng-model="data.cb_clientId" aria-label="Checkbox 2" class="md-warn md-align-top-left">clientId</md-checkbox><md-input-container><md-button class="md-raised" ng-click="save()">Save</md-button></md-input-container><md-input-container><md-button class="md-raised md-warn" ng-click="cancel()">Cancel</md-button></md-input-container></md-content></md-sidenav></section></md-content></div>'),e.put("app/components/navbar/navbar.html",'<md-toolbar layout="row" layout-align="center center"><md-button href="https://github.com/Swiip/generator-gulp-angular">CMMC Devices</md-button><section flex="" layout="row" layout-align="left center"><md-button href="#" class="md-raised">Home</md-button><md-button href="#" class="md-raised">About</md-button><md-button href="#" class="md-raised">Contact</md-button></section></md-toolbar>')}]);